<IfModule mod_ssl.c>
<VirtualHost *:443>
	ServerName {{ jupyter_domain }}
	ServerAdmin webmaster@{{ ansible_fqdn }}

	RequestHeader set Host "{{ jupyter_domain }}"
	RequestHeader set X-Forwarded-Ssl on
	RequestHeader set X-Forwarded-For %{REMOTE_ADDR}e
	RequestHeader set X-Forwarded-Proto "https"

	ProxyPreserveHost On
	ProxyPass / http://localhost:{{ jupyter_port }}/
	ProxyPassReverse / http://localhost:{{ jupyter_port }}/

	ErrorLog ${APACHE_LOG_DIR}/error-{{ jupyter_subdomain }}.log
	CustomLog ${APACHE_LOG_DIR}/access-{{ jupyter_subdomain }}.log combined

{% if certbot == "yes" %}
SSLCertificateFile /etc/letsencrypt/live/{{ ansible_fqdn }}/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/{{ ansible_fqdn }}/privkey.pem
Include /etc/letsencrypt/options-ssl-apache.conf
{% else %}
SSLCertificateFile /etc/ssl/certs/ssl-cert-snakeoil.pem
SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key
{% endif %}

</VirtualHost>
</IfModule>
